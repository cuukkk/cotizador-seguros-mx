<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Seguros MX 2026</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; line-height: 1.6; color: #1a1a1a; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px 0; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.15); overflow: hidden; }
        header { background: linear-gradient(90deg, #667eea, #764ba2); color: white; padding: 30px; text-align: center; }
        h1 { font-size: 2.2em; margin: 0; }
        .step { padding: 40px; display: none; }
        .step.active { display: block; animation: slideIn 0.6s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; color: #374151; margin-bottom: 8px; }
        input, select { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; }
        input:focus, select:focus { border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); outline: none; }
        button { width: 100%; padding: 16px; background: linear-gradient(90deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s; margin: 10px 0; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.4); }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        .back-btn { background: #6b7280; }
        .result-card { background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 2px solid #0ea5e9; border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0; }
        .price-big { font-size: 3.5em; color: #059669; font-weight: 800; margin: 10px 0; }
        .payment-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .plan-card { padding: 25px; border: 2px solid #e5e7eb; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .plan-card.selected { border-color: #667eea; background: rgba(102,126,234,0.05); transform: scale(1.02); }
        .plan-price { font-size: 2.2em; color: #059669; font-weight: 700; }
        @media (max-width: 768px) { .step { padding: 25px 20px; } .price-big { font-size: 2.8em; } }
    </style>
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GA_MEASUREMENT_ID');
</script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Cotizador Inteligente de Seguros 2026</h1>
            <p>Perfila ‚Üí Cotiza ‚Üí Detalla ‚Üí Paga</p>
        </header>
        
        <!-- PASO 1: Perfil B√°sico -->
        <div id="step1" class="step active">
            <h2>üìã 1. Perfil B√°sico</h2>
            <form id="profileForm">
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" id="name" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Edad *</label>
                        <input type="number" id="age" min="18" max="80" required>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="state" required>
                            <option value="">Selecciona...</option>
                            <option value="cdmx">CDMX (+15%)</option>
                            <option value="nl">Nuevo Le√≥n</option>
                            <option value="jal">Jalisco</option>
                            <option value="otro">-15%</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Tipo de Seguro *</label>
                    <select id="type" required>
                        <option value="">Selecciona...</option>
                        <option value="auto">üöó Auto</option>
                        <option value="salud">üè• Gastos M√©dicos</option>
                        <option value="vida">üíº Vida</option>
                    </select>
                </div>
                <button type="submit">Siguiente ‚Üí Detalles</button>
            </form>
        </div>
        
        <!-- PASO 2: Detalles Espec√≠ficos -->
        <div id="step2" class="step">
            <h2>üìù 2. Detalles del Seguro</h2>
            <form id="detailsForm">
                <div class="form-group">
                    <label id="detailsLabel">Detalles del Auto *</label>
                    <input type="text" id="details" placeholder="Ej: Nissan Versa 2020, Chevrolet Spark..." required>
                </div>
                <div class="form-group">
                    <label>Cobertura</label>
                    <select id="coverage">
                        <option value="basica">B√°sica</option>
                        <option value="amplia" selected>Amplia</option>
                        <option value="todo-riesgo">Todo Riesgo (+40%)</option>
                    </select>
                </div>
                <button type="submit">Calcular ‚Üí Cotizaci√≥n</button>
                <button type="button" class="back-btn" onclick="showStep(1)">‚Üê Atr√°s</button>
            </form>
        </div>
        
        <!-- PASO 3: Cotizaci√≥n -->
        <div id="step3" class="step">
            <h2>üí∞ 3. Tu Cotizaci√≥n</h2>
            <div id="quoteSummary" class="result-card"></div>
            <div class="payment-grid" id="paymentPlans"></div>
            <button id="proceedPay" disabled>‚úÖ Confirmar y Pagar</button>
            <button class="back-btn" onclick="showStep(2)">‚Üê Editar Detalles</button>
        </div>
        
        <!-- PASO 4: Pago (SIMULADO) -->
        <div id="step4" class="step">
            <h2>üí≥ 4. Pago Confirmado</h2>
            <div style="background: #d4edda; border: 2px solid #c3e6cb; border-radius: 16px; padding: 40px; text-align: center;">
                <h3>‚úÖ ¬°Cotizaci√≥n Guardada!</h3>
                <p><strong>Pr√≥ximo paso:</strong> Un agente te contactar√° en <strong>5 minutos</strong> para finalizar.</p>
                <div style="font-size: 3em; color: #28a745; margin: 20px 0;">üìû</div>
                <p><small>Simulaci√≥n. En prod: integra Mercado Pago aqu√≠.</small></p>
            </div>
            <button class="back-btn" onclick="showStep(3)">‚Üê Cambiar Plan</button>
        </div>
    </div>

    <script>
        const MP_PUBLIC_KEY = 'TEST-APP_USR-1234567890abcde'; // Reemplaza
        const mp = new MercadoPago(MP_PUBLIC_KEY);
        
        // Precios 2026 MXN
        const priceCatalog = {
            auto: { base: 7500, models: {spark:7090,versa:8200,tiguan:13060}, factors: {ageUnder25:1.35,ageUnder30:1.25,cdmx:1.15,todoRiesgo:1.4} },
            salud: { base: 48000, factors: {age61plus:2.0,cdmx:1.1,todoRiesgo:1.3} },
            vida: { base: 1560, factors: {ageOver50:2.0} }
        };
        
        let profile = {};
        
        // Paso 1 ‚Üí Paso 2
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            profile = {
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                state: document.getElementById('state').value,
                type: document.getElementById('type').value
            };
            document.getElementById('detailsLabel').textContent = `Detalles ${profile.type === 'auto' ? 'Auto' : profile.type === 'salud' ? 'Familia' : 'Cobertura'}`;
            showStep(2);
        });
        
        // Paso 2 ‚Üí Paso 3 (Calcular)
        document.getElementById('detailsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            profile.details = document.getElementById('details').value.toLowerCase();
            profile.coverage = document.getElementById('coverage').value;
            
            // C√ÅLCULO
            const cat = priceCatalog[profile.type];
            let annual = cat.base;
            
            if (profile.type === 'auto') {
                for (let model in cat.models) if (profile.details.includes(model)) annual = cat.models[model];
                if (profile.age < 25) annual *= cat.factors.ageUnder25;
                else if (profile.age < 30) annual *= cat.factors.ageUnder30;
                if (profile.coverage === 'todo-riesgo') annual *= cat.factors.todoRiesgo;
            }
            
            if (profile.state === 'cdmx') annual *= cat.factors.cdmx || 1.1;
            profile.annual = Math.round(annual);
            
            showStep(3);
            renderQuote();
        });
        
        function renderQuote() {
            document.getElementById('quoteSummary').innerHTML = `
                <h3>Para ${profile.name}</h3>
                <p><strong>${profile.type.toUpperCase()}</strong> | ${profile.age} a√±os | ${profile.state.toUpperCase()}</p>
                <p>${profile.details} | ${profile.coverage}</p>
                <div class="price-big">$${profile.annual.toLocaleString()}</div>
                <p>Precio anual calculado con datos reales 2026</p>
            `;
            
            const mensual = Math.round(profile.annual / 12);
            const semestral = Math.round(profile.annual / 6 * 0.95);
            const anual = profile.annual;
            
            document.getElementById('paymentPlans').innerHTML = `
                <div class="plan-card" data-amount="${mensual}" data-period="mensual">
                    <h4>Mensual</h4><div class="plan-price">$${mensual}</div><p>12 pagos</p>
                </div>
                <div class="plan-card" data-amount="${semestral}" data-period="semestral">
                    <h4>Semestral</h4><div class="plan-price">$${semestral}</div><p>2 pagos ‚Ä¢ 5% OFF</p>
                </div>
                <div class="plan-card selected" data-amount="${anual}" data-period="anual">
                    <h4>Anual</h4><div class="plan-price">$${anual}</div><p>1 pago ‚Ä¢ 15% OFF</p>
                </div>
            `;
            
            document.querySelectorAll('.plan-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    profile.selectedAmount = parseInt(card.dataset.amount);
                    profile.period = card.dataset.period;
                    document.getElementById('proceedPay').disabled = false;
                });
            });
        }
        
        // Paso 3 ‚Üí Paso 4 (Lead Capturado)
        document.getElementById('proceedPay').addEventListener('click', () => {
            showStep(4);
            // En prod: EmailJS o fetch('/lead') para guardar
            console.log('LEAD:', profile);
        });
        
        function showStep(n) {
            document.querySelectorAll('.step').forEach((s, i) => {
                s.classList.toggle('active', i + 1 === n);
            });
        }
    </script>
    <!-- EmailJS - Leads a tu Gmail -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
emailjs.init("TU_PUBLIC_KEY"); // Reg√≠strate emailjs.com ‚Üí gratis

// En lugar de console.log('LEAD:', profile);
document.getElementById('proceedPay').addEventListener('click', () => {
    showStep(4);
    
    emailjs.send('service_abc', 'template_xyz', {
        to_name: 'Tu Nombre',
        from_name: profile.name,
        from_age: profile.age,
        from_type: profile.type,
        from_price: `$${profile.annual}`,
        from_period: profile.period,
        from_details: profile.details
    }).then(() => console.log('‚úÖ LEAD ENVIADO'));
});
</script>
</body>
</html>
