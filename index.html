<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Seguros MX 2026 - Perfila & Contrata</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; color: #1a1a1a; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px 0; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.15); overflow: hidden; }
        header { background: linear-gradient(90deg, #667eea, #764ba2); color: white; padding: 30px; text-align: center; }
        h1 { font-size: 2.2em; margin: 0; }
        .step { padding: 40px; display: none; }
        .step.active { display: block; animation: slideIn 0.6s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 0.95em; }
        input, select { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; }
        input:focus, select:focus { border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); outline: none; }
        button { width: 100%; padding: 16px; background: linear-gradient(90deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.4); }
        button:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        .back-btn { background: #6b7280; margin-top: 20px; }
        .back-btn:hover { box-shadow: 0 10px 25px rgba(107,114,128,0.4); }
        .result-card { background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 2px solid #0ea5e9; border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0; }
        .price-big { font-size: 3.5em; color: #059669; font-weight: 800; margin: 10px 0; text-shadow: 0 2px 4px rgba(5,150,105,0.2); }
        .payment-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .plan-card { padding: 25px; border: 2px solid #e5e7eb; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .plan-card::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(102,126,234,0.2), transparent); transition: 0.5s; }
        .plan-card:hover::before { left: 100%; }
        .plan-card.selected { border-color: #667eea; background: rgba(102,126,234,0.05); transform: scale(1.02); }
        .plan-price { font-size: 2.2em; color: #059669; font-weight: 700; }
        .details { font-size: 0.9em; color: #6b7280; }
        @media (max-width: 768px) { .container { margin: 10px; border-radius: 16px; } .step { padding: 25px 20px; } .price-big { font-size: 2.8em; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Cotizador Inteligente de Seguros 2026</h1>
            <p>Perfila tu riesgo, cotiza preciso, paga seguro con Mercado Pago</p>
        </header>
        
        <!-- Paso 1: Perfil Detallado -->
        <div id="step1" class="step active">
            <h2 style="text-align: center; color: #1f2937; margin-bottom: 30px;">üìã Perfil de Riesgo</h2>
            <form id="profileForm">
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" id="name" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Edad *</label>
                        <input type="number" id="age" min="18" max="80" required>
                    </div>
                    <div class="form-group">
                        <label>Estado (MX) *</label>
                        <select id="state" required>
                            <option value="">Selecciona...</option>
                            <option value="cdmx">CDMX (+15%)</option>
                            <option value="nl">Nuevo Le√≥n</option>
                            <option value="jal">Jalisco</option>
                            <option value="otro">-15%</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Tipo de Seguro *</label>
                    <select id="type" required>
                        <option value="">Selecciona...</option>
                        <option value="auto">üöó Auto</option>
                        <option value="salud">üè• Gastos M√©dicos</option>
                        <option value="vida">üíº Vida</option>
                    </select>
                </div>
                <div class="form-group" id="detailsGroup" style="display: none;">
                    <label>Detalles Espec√≠ficos *</label>
                    <input type="text" id="details" placeholder="Auto: Nissan Versa 2020 / Salud: Familia 4p / Vida: B√°sico">
                </div>
                <button type="submit">üöÄ Calcular Cotizaci√≥n Precisa</button>
            </form>
        </div>
        
        <!-- Paso 2: Cotizaci√≥n -->
        <div id="step2" class="step">
            <h2 style="text-align: center; color: #1f2937;">üí∞ Tu Cotizaci√≥n Personalizada</h2>
            <div id="quoteSummary" class="result-card"></div>
            <div class="payment-grid" id="paymentPlans"></div>
            <button id="proceedPay">‚úÖ Pagar con Tarjeta (Mercado Pago)</button>
            <button class="back-btn" onclick="showStep(1)">‚Üê Editar Perfil</button>
        </div>
        
        <!-- Paso 3: Checkout MP -->
        <div id="step3" class="step">
            <h2 style="text-align: center; color: #1f2937;">üí≥ Procesando Pago Seguro</h2>
            <div id="mpFormContainer" style="min-height: 400px;"></div>
            <button class="back-btn" onclick="showStep(2)">‚Üê Cambiar Plan</button>
            <p style="text-align: center; color: #6b7280; font-size: 0.9em;">Pago 100% seguro con Mercado Pago</p>
        </div>
    </div>

    <script>
        // Config Mercado Pago (obt√©n keys gratis: https://www.mercadopago.com.mx/developers/panel)
        const MP_PUBLIC_KEY = 'TEST-APP_USR-1234567890abcde'; // Reemplaza con TU TEST PUBLIC_KEY
        const MP_ACCESS_TOKEN = 'TEST-APP_USR-1234567890abcde'; // Para demo; PROD usa backend!
        const mp = new MercadoPago(MP_PUBLIC_KEY);
        
        // Precios BASE ANUALES 2026 MXN de fuentes reales [web:19][web:20][web:21][web:25]
        const priceCatalog = {
            auto: {
                base: 7500, // Promedio limitado-amplio
                models: { 'spark': 7090, 'versa': 8200, 'renegade': 8100, 'escape': 8630, 'tiguan': 13060 },
                factors: { ageUnder25: 1.35, ageUnder30: 1.25, cdmx: 1.15 }
            },
            salud: {
                base: 48000, // Mensual $2.5k-10k x12 [web:20][web:25]
                factors: { ageUnder30: 0.85, age41_50: 1.2, age51_60: 1.5, age61+: 2.0, cdmx: 1.1 }
            },
            vida: {
                base: 1560, // Mensual $65-130 x12 [web:21]
                factors: { ageOver50: 2.0 }
            }
        };
        
        let currentQuote = {};
        
        // Mostrar/ocultar detalles por tipo
        document.getElementById('type').addEventListener('change', (e) => {
            document.getElementById('detailsGroup').style.display = e.target.value ? 'block' : 'none';
        });
        
        // Submit perfil ‚Üí calcular
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = {
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                state: document.getElementById('state').value,
                type: document.getElementById('type').value,
                details: document.getElementById('details').value.toLowerCase()
            };
            
            // C√ÅLCULO PRECISO
            const cat = priceCatalog[formData.type];
            let annual = cat.base;
            
            // Auto: modelo espec√≠fico
            if (formData.type === 'auto') {
                for (let model in cat.models) {
                    if (formData.details.includes(model)) {
                        annual = cat.models[model];
                        break;
                    }
                }
                if (formData.age < 25) annual *= cat.factors.ageUnder25;
                else if (formData.age < 30) annual *= cat.factors.ageUnder30;
            }
            
            // Salud/Vida: edad
            if (formData.type === 'salud') {
                if (formData.age >= 61) annual *= cat.factors['age61+'];
                else if (formData.age >= 51) annual *= cat.factors.age51_60;
                else if (formData.age >= 41) annual *= cat.factors.age41_50;
                else if (formData.age < 30) annual *= cat.factors.ageUnder30;
            } else if (formData.type === 'vida' && formData.age > 50) {
                annual *= cat.factors.ageOver50;
            }
            
            // Estado
            if (formData.state === 'cdmx') {
                annual *= priceCatalog[formData.type].factors?.cdmx || 1.1;
            } else if (formData.state === 'otro') {
                annual *= 0.85;
            }
            
            currentQuote = { ...formData, annual: Math.round(annual) };
            showStep(2);
            renderQuote();
        });
        
        function renderQuote() {
            document.getElementById('quoteSummary').innerHTML = `
                <h3>Para ${currentQuote.name}</h3>
                <p><strong>${currentQuote.type.toUpperCase()}</strong> | Edad: ${currentQuote.age} | ${currentQuote.state.toUpperCase()} | ${currentQuote.details}</p>
                <div class="price-big">$${currentQuote.annual.toLocaleString()}</div>
                <p class="details">Precio anual base calculado con datos 2026 reales</p>
            `;
            
            const mensual = (currentQuote.annual / 12).toFixed(0);
            const semestral = Math.round(currentQuote.annual / 6 * 0.95);
            const anual = currentQuote.annual;
            
            document.getElementById('paymentPlans').innerHTML = `
                <div class="plan-card" data-amount="${mensual}" data-period="mensual">
                    <h4>Mensual</h4>
                    <div class="plan-price">$${mensual}</div>
                    <p>12 pagos</p>
                </div>
                <div class="plan-card" data-amount="${semestral}" data-period="semestral">
                    <h4>Semestral</h4>
                    <div class="plan-price">$${semestral}</div>
                    <p>2 pagos ‚Ä¢ 5% OFF</p>
                </div>
                <div class="plan-card selected" data-amount="${anual}" data-period="anual">
                    <h4>Anual</h4>
                    <div class="plan-price">$${anual}</div>
                    <p>1 pago ‚Ä¢ 15% OFF</p>
                </div>
            `;
            
            // Handlers planes
            document.querySelectorAll('.plan-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    currentQuote.selectedAmount = parseInt(card.dataset.amount);
                    currentQuote.period = card.dataset.period;
                    document.getElementById('proceedPay').disabled = false;
                });
            });
            document.getElementById('proceedPay').disabled = true;
        }
        
        // Pagar
        document.getElementById('proceedPay').addEventListener('click', () => {
            showStep(3);
            createMPCheckout();
        });
        
        async function createMPCheckout() {
            // En PROD: POST a tu backend /create-preference
            const preference = {
                items: [{
                    id: currentQuote.type,
                    title: `${currentQuote.type.toUpperCase()} ${currentQuote.period.toUpperCase()} - ${currentQuote.name}`,
                    description: `${currentQuote.details} | Edad ${currentQuote.age}`,
                    unit_price: currentQuote.selectedAmount,
                    quantity: 1,
                    currency_id: 'MXN'
                }],
                payer: { name: currentQuote.name, email: 'cliente@ejemplo.com' }, // Agrega email input
                back_urls: {
                    success: `${window.location.href}?status=success`,
                    failure: `${window.location.href}?status=failure`,
                    pending: `${window.location.href}?status=pending`
                },
                auto_return: 'approved',
                payment_methods: { installments: 12 }
            };
            
            // Demo: simula (reemplaza con fetch('tu-api/create-preference', {method:'POST', body: JSON.stringify(preference)}))
            const mockResponse = { body: { id: 'fake-pref-id', init_point: 'https://www.mercadopago.com.mx/checkout/v1/redirect?pref_id=fake' } };
            
            mp.checkout({
                preference: { id: mockResponse.body.id },
                render: {
                    container: '#mpFormContainer',
                    label: `Pagar $${currentQuote.selectedAmount.toLocaleString()} MXN`,
                    color: '#667eea'
                }
            });
        }
        
        function showStep(step) {
            document.querySelectorAll('.step').forEach((s, i) => s.classList.toggle('active', i + 1 === step));
        }
    </script>
</body>
</html>
